{% extends "base.html" %}

{% block title %}æœåŠ¡å™¨æ—¥å¿— - openEar{% endblock %}

{% block extra_css %}
<style>
    .logs-container {
        max-width: 100%;
        margin: 20px auto;
        padding: 16px;
        background: var(--bg-primary, #ffffff);
    }
    
    .logs-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        flex-wrap: wrap;
        gap: 12px;
    }
    
    .logs-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }
    
    .btn-refresh, .btn-clear {
        padding: 8px 16px;
        border: 1px solid var(--border, #e5e7eb);
        border-radius: 6px;
        background: var(--bg-secondary, #f9fafb);
        color: var(--text-primary, #1f2937);
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
    }
    
    .btn-refresh:hover, .btn-clear:hover {
        background: var(--hf-primary-light, #dbeafe);
        border-color: var(--hf-primary, #3b82f6);
    }
    
    .logs-content {
        background: var(--bg-secondary, #1f2937);
        color: var(--text-inverse, #f9fafb);
        padding: 16px;
        border-radius: 8px;
        font-family: 'JetBrains Mono', 'Space Mono', 'Courier New', monospace;
        font-size: 12px;
        line-height: 1.6;
        overflow-x: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
        max-height: 70vh;
        overflow-y: auto;
    }
    
    .logs-content::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }
    
    .logs-content::-webkit-scrollbar-track {
        background: var(--bg-primary, #111827);
    }
    
    .logs-content::-webkit-scrollbar-thumb {
        background: var(--hf-primary, #3b82f6);
        border-radius: 4px;
    }
    
    .error-message {
        padding: 12px;
        background: #fee2e2;
        border: 1px solid #fecaca;
        border-radius: 6px;
        color: #991b1b;
        margin-bottom: 16px;
    }
    
    .info-message {
        padding: 12px;
        background: #dbeafe;
        border: 1px solid #93c5fd;
        border-radius: 6px;
        color: #1e40af;
        margin-bottom: 16px;
        font-size: 13px;
    }
    
    @media (max-width: 768px) {
        .logs-container {
            padding: 12px;
        }
        
        .logs-content {
            font-size: 11px;
            padding: 12px;
            max-height: 60vh;
        }
        
        .logs-header h1 {
            font-size: 20px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="logs-container">
    <div class="logs-header">
        <h1 style="margin: 0; font-size: 24px;">ğŸ“‹ æœåŠ¡å™¨æ—¥å¿—</h1>
        <div class="logs-actions">
            <button class="btn-refresh" onclick="refreshLogs()">ğŸ”„ åˆ·æ–°</button>
            <button class="btn-clear" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…ç©ºæ˜¾ç¤º</button>
        </div>
    </div>
    
    {% if error %}
    <div class="error-message">
        âš ï¸ {{ error }}
    </div>
    {% endif %}
    
    <div class="info-message">
        ğŸ’¡ æç¤ºï¼šè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯æœåŠ¡å™¨æ—¥å¿—çš„æœ€å1000è¡Œã€‚å¦‚æœéœ€è¦æŸ¥çœ‹å®Œæ•´æ—¥å¿—ï¼Œè¯·é€šè¿‡SSHè¿æ¥åˆ°æœåŠ¡å™¨ã€‚
        <br>æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š<code>logs/app.log</code> æˆ–æœåŠ¡å™¨æ§åˆ¶å°è¾“å‡º
    </div>
    
    <div class="logs-content" id="logsContent">{{ logs }}</div>
</div>

<script>
function refreshLogs() {
    const content = document.getElementById('logsContent');
    content.textContent = 'æ­£åœ¨åˆ·æ–°...';
    
    fetch('/api/logs/recent')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'ok') {
                content.textContent = data.logs || 'æš‚æ— æ—¥å¿—';
                // æ»šåŠ¨åˆ°åº•éƒ¨
                content.scrollTop = content.scrollHeight;
            } else {
                content.textContent = 'åˆ·æ–°å¤±è´¥: ' + (data.msg || 'æœªçŸ¥é”™è¯¯');
            }
        })
        .catch(error => {
            content.textContent = 'åˆ·æ–°å¤±è´¥: ' + error.message;
        });
}

function clearLogs() {
    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ˜¾ç¤ºçš„æ—¥å¿—å—ï¼Ÿï¼ˆä¸ä¼šåˆ é™¤æœåŠ¡å™¨ä¸Šçš„æ—¥å¿—æ–‡ä»¶ï¼‰')) {
        document.getElementById('logsContent').textContent = 'æ—¥å¿—å·²æ¸…ç©ºï¼ˆåˆ·æ–°å¯é‡æ–°åŠ è½½ï¼‰';
    }
}

// é¡µé¢åŠ è½½æ—¶æ»šåŠ¨åˆ°åº•éƒ¨
document.addEventListener('DOMContentLoaded', function() {
    const content = document.getElementById('logsContent');
    content.scrollTop = content.scrollHeight;
});

// è‡ªåŠ¨åˆ·æ–°ï¼ˆå¯é€‰ï¼Œæ¯30ç§’ï¼‰
// setInterval(refreshLogs, 30000);
</script>
{% endblock %}

